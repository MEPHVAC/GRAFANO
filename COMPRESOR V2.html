<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Animación SVG por Capas</title>
    <style>
        body {
            background: white;
            color: black;
            font-family: sans-serif;
            text-align: center;
            margin: 20px;
        }

        object {
            width: 400px;
            height: auto;
            display: block;
            margin: auto;
        }

        .controls {
            margin-top: 20px;
        }

        #toggleButton {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }

        #speedSlider {
            width: 200px;
            margin-left: 10px;
        }

        #speedValue {
            font-weight: bold;
            margin-left: 5px;
        }
    </style>
</head>

<body>
    <h1>Animación SVG por Capas</h1>

    <object id="svgObject" type="image/svg+xml" data="media/COMP.svg"></object>

    <div class="controls">
        <button id="toggleButton">Estado: OFF</button>
        <label>
            Velocidad:
            <input type="range" id="speedSlider" min="5" max="10" step="0.1" value="7.5">
            <span id="speedValue">10ms</span>
        </label>
    </div>

    <script>
        const button = document.getElementById("toggleButton");
        const svgObject = document.getElementById("svgObject");
        const slider = document.getElementById("speedSlider");
        const speedValue = document.getElementById("speedValue");

        const animationLayers = [
            "g42839", "g42843", "g42847", "g42851",
            "g42855", "g42859", "g42863", "g42867",
            "g42875", "g42879", "g42883", "g42887"
        ];

        const offLayer = "layer1";
        let isOn = false;
        let intervalId = null;
        let speed = +slider.value;
        let svgDoc = null;

        const updateSpeed = () => {
            speed = +slider.value;
            speedValue.textContent = `${speed}ms`;
            if (isOn) startAnimation();
        };

        const showOnlyLayer = (id) => {
            animationLayers.forEach(layerId => {
                const el = svgDoc.getElementById(layerId);
                if (el) el.style.display = (layerId === id) ? "inline" : "none";
            });
        };

        const startAnimation = () => {
            clearInterval(intervalId);
            let index = 0, forward = true;

            intervalId = setInterval(() => {
                showOnlyLayer(animationLayers[index]);

                if (forward) {
                    index++;
                    if (index === animationLayers.length) {
                        index = animationLayers.length - 2;
                        forward = false;
                    }
                } else {
                    index--;
                    if (index < 0) {
                        index = 1;
                        forward = true;
                    }
                }
            }, speed);
        };

        const toggleState = () => {
            isOn = !isOn;
            button.textContent = `Estado: ${isOn ? "ON" : "OFF"}`;

            if (!svgDoc) return;

            animationLayers.forEach(id => {
                const el = svgDoc.getElementById(id);
                if (el) el.style.display = "none";
            });

            const offEl = svgDoc.getElementById(offLayer);
            if (offEl) offEl.style.display = isOn ? "none" : "inline";

            isOn ? startAnimation() : clearInterval(intervalId);
        };

        slider.addEventListener("input", updateSpeed);
        button.addEventListener("click", toggleState);

        svgObject.addEventListener("load", () => {
            svgDoc = svgObject.contentDocument;
            toggleState(); // inicia en OFF
        });
    </script>
</body>

</html>